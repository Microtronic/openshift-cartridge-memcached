#!/bin/bash -e

source $OPENSHIFT_CARTRIDGE_SDK_BASH

# setup sasl
username="$(generate_username)@$OPENSHIFT_APP_NAME"
password=$(generate_password)

set_env_var OPENSHIFT_MEMCACHED_USERNAME "$username" env
set_env_var OPENSHIFT_MEMCACHED_PASSWORD "$password" env

# Memcached uses a plain text "username:password" database file
echo "$username:$password" > $OPENSHIFT_MEMCACHED_DIR/conf/sasldb

client_result ' '
client_result 'Use the following env vars on your application to connect to memcached:'
client_result ' OPENSHIFT_MEMCACHED_HOST'
client_result ' OPENSHIFT_MEMCACHED_PORT'
client_result ' OPENSHIFT_MEMCACHED_USERNAME'
client_result ' OPENSHIFT_MEMCACHED_PASSWORD'
client_result ' '
client_result 'To disable authentication, add the DISABLE_SASL=1 environment variable and restart your application:'
client_result ' '
client_result ' $ rhc set-env DISABLE_SASL=1 --app [APP]'
client_result ' $ rhc app-restart --app [APP]'
